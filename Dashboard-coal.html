<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coal Usage Analytics</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Google Fonts: Prompt -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Prompt', sans-serif; 
            background-color: #0f172a; /* Dark Navy Background */
            color: #f8fafc;
            min-height: 100vh;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Panel) */
        .panel {
            background-color: #1e293b; 
            border: 1px solid #334155;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏•‡πà‡∏™‡∏µ */
        .text-gradient-cyan {
            background: linear-gradient(to right, #2dd4bf, #0ea5e9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Input ‡∏™‡πÑ‡∏ï‡∏•‡πå Dark Mode (Date Picker) */
        .dark-input {
            background-color: #0f172a;
            border: 1px solid #475569;
            color: #e2e8f0;
            border-radius: 6px;
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
            outline: none;
            cursor: pointer;
        }
        .dark-input:focus {
            border-color: #2dd4bf;
        }
        /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏ô‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î */
        ::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }

        .chart-container { position: relative; height: 320px; width: 100%; }
        
        /* Scrollbar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* Loading Screen ‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î */
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.9); z-index: 9999;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-8">

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div id="loading-overlay">
        <div class="relative w-16 h-16">
            <div class="absolute top-0 left-0 w-full h-full border-4 border-slate-700 rounded-full"></div>
            <div class="absolute top-0 left-0 w-full h-full border-4 border-teal-400 rounded-full border-t-transparent animate-spin"></div>
        </div>
        <h2 class="text-xl font-bold text-slate-200 mt-6 tracking-wide">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h2>
        <p class="text-slate-400 mt-2 text-sm text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Google Sheet</p>
    </div>

    <div class="max-w-[1400px] mx-auto space-y-6 hidden" id="main-content">
        
        <!-- Header & Filters ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà (Date Range) -->
        <div class="panel p-4 lg:p-6 flex flex-col xl:flex-row justify-between items-start xl:items-center gap-6 border-l-4 border-l-teal-400">
            <div class="flex items-center gap-4">
                <div class="p-2 bg-slate-800 rounded-lg border border-slate-700">
                    <svg class="w-8 h-8 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gradient-cyan tracking-wide">Coal Usage Analytics</h1>
                    <p class="text-slate-400 text-xs mt-1">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</p>
                </div>
            </div>
            
            <!-- ‡πÅ‡∏ñ‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
            <div class="flex flex-wrap items-center gap-3 bg-slate-900/50 p-2.5 rounded-lg border border-slate-700/50 w-full xl:w-auto">
                <!-- Dropdown ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡πà‡∏ß‡∏ô -->
                <div class="flex items-center gap-2">
                    <span class="text-slate-400 text-sm font-medium px-1">‡∏î‡∏π‡∏î‡πà‡∏ß‡∏ô:</span>
                    <select id="quick-month" class="dark-input" onchange="applyQuickMonth()">
                        <option value="">-- ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏≠‡∏á --</option>
                    </select>
                </div>
                
                <div class="w-px h-6 bg-slate-700 mx-1 hidden sm:block"></div>
                
                <div class="flex items-center gap-2">
                    <span class="text-slate-400 text-sm font-medium px-1">‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà:</span>
                    <input type="date" id="start-date" class="dark-input" onchange="clearQuickMonth()">
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-slate-400 text-sm font-medium px-1">‡∏ñ‡∏∂‡∏á:</span>
                    <input type="date" id="end-date" class="dark-input" onchange="clearQuickMonth()">
                </div>
                
                <div class="flex items-center gap-2 w-full sm:w-auto mt-2 sm:mt-0 ml-auto xl:ml-2">
                    <button onclick="applyFilters()" class="flex-1 sm:flex-none bg-teal-500 hover:bg-teal-600 text-white text-sm font-medium px-4 py-2 rounded flex items-center justify-center gap-2 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>
                        ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                    <button onclick="resetFilters()" class="bg-slate-700 hover:bg-slate-600 text-white text-sm font-medium px-4 py-2 rounded transition-colors">
                        ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
                    </button>
                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà -->
                    <button onclick="loadData()" class="flex-1 sm:flex-none bg-cyan-600 hover:bg-cyan-500 text-white text-sm font-medium px-4 py-2 rounded flex items-center justify-center gap-2 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                        ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                </div>
            </div>
        </div>

        <!-- Top KPI Summary (5 ‡∏Å‡∏•‡πà‡∏≠‡∏á) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
            <!-- Output (Green) -->
            <div class="panel p-5 border border-emerald-500/30 relative overflow-hidden">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-slate-400 mb-1">‡∏¢‡∏≠‡∏î‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏ß‡∏° (Output)</p>
                        <p class="text-3xl font-bold text-emerald-400" id="kpi-output">0</p>
                        <p class="text-xs text-slate-500 mt-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢: ‡∏ï‡∏±‡∏ô (Ton)</p>
                    </div>
                    <div class="p-2 bg-emerald-500/10 rounded border border-emerald-500/20">
                        <svg class="w-6 h-6 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                    </div>
                </div>
            </div>
            
            <!-- Cost (Pink/Rose) -->
            <div class="panel p-5 border border-rose-500/30 relative overflow-hidden">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-slate-400 mb-1">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡πà‡∏≤‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô‡∏£‡∏ß‡∏°</p>
                        <p class="text-3xl font-bold text-rose-400" id="kpi-cost">0</p>
                        <p class="text-xs text-slate-500 mt-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢: ‡∏ö‡∏≤‡∏ó (Baht)</p>
                    </div>
                    <div class="p-2 bg-rose-500/10 rounded border border-rose-500/20">
                        <svg class="w-6 h-6 text-rose-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    </div>
                </div>
            </div>

            <!-- Baht / Output (Yellow/Amber) -->
            <div class="panel p-5 border border-amber-500/30 relative overflow-hidden">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-slate-400 mb-1">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ‡∏ø / Output</p>
                        <p class="text-3xl font-bold text-amber-400 flex items-baseline gap-1">
                            <span class="text-xl">‡∏ø</span> <span id="kpi-baht-output">0.000</span>
                        </p>
                        <p class="text-xs text-slate-500 mt-1">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ú‡∏•‡∏¥‡∏ï</p>
                    </div>
                    <div class="p-2 bg-amber-500/10 rounded border border-amber-500/20">
                        <svg class="w-6 h-6 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                    </div>
                </div>
            </div>

            <!-- Average Coal Price (Indigo) -->
            <div class="panel p-5 border border-indigo-500/30 relative overflow-hidden">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-slate-400 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                        <p class="text-3xl font-bold text-indigo-400 flex items-baseline gap-1">
                            <span class="text-xl">‡∏ø</span> <span id="kpi-avg-coal-price">0.00</span>
                        </p>
                        <p class="text-xs text-slate-500 mt-1">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                    </div>
                    <div class="p-2 bg-indigo-500/10 rounded border border-indigo-500/20">
                        <svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>
                    </div>
                </div>
            </div>

            <!-- Average Coal/Water (Purple) -->
            <div class="panel p-5 border border-purple-500/30 relative overflow-hidden">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-slate-400 mb-1">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ‡∏ñ‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏≠‡∏ô‡πâ‡∏≥</p>
                        <p class="text-3xl font-bold text-purple-400" id="kpi-avg-coal-water">0.00</p>
                        <p class="text-xs text-slate-500 mt-1">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Target): 208</p>
                    </div>
                    <div class="p-2 bg-purple-500/10 rounded border border-purple-500/20">
                        <svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Steam KPI (Target 302) -->
        <div class="panel p-5 border-t-2 border-t-slate-600">
            <h2 class="text-sm font-semibold text-slate-300 mb-4 flex items-center gap-2">
                <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ‡πÑ‡∏≠‡∏ô‡πâ‡∏≥‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 302 ml/kg Output)
            </h2>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div id="kpi-steam-total-card" class="p-4 rounded-lg bg-slate-800/50 border border-slate-700">
                    <p class="text-xs text-slate-400 mb-1">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Total)</p>
                    <p class="text-2xl font-bold text-slate-200" id="kpi-steam-total">-</p>
                    <p class="text-xs mt-1" id="kpi-steam-total-diff"></p>
                </div>
                <div id="kpi-steam-isowa-card" class="p-4 rounded-lg bg-slate-800/50 border border-slate-700">
                    <p class="text-xs text-slate-400 mb-1">ISOWA</p>
                    <p class="text-2xl font-bold text-slate-200" id="kpi-steam-isowa">-</p>
                    <p class="text-xs mt-1" id="kpi-steam-isowa-diff"></p>
                </div>
                <div id="kpi-steam-bhs-card" class="p-4 rounded-lg bg-slate-800/50 border border-slate-700">
                    <p class="text-xs text-slate-400 mb-1">BHS</p>
                    <p class="text-2xl font-bold text-slate-200" id="kpi-steam-bhs">-</p>
                    <p class="text-xs mt-1" id="kpi-steam-bhs-diff"></p>
                </div>
                <div id="kpi-steam-yueli-card" class="p-4 rounded-lg bg-slate-800/50 border border-slate-700">
                    <p class="text-xs text-slate-400 mb-1">YUELI</p>
                    <p class="text-2xl font-bold text-slate-200" id="kpi-steam-yueli">-</p>
                    <p class="text-xs mt-1" id="kpi-steam-yueli-diff"></p>
                </div>
            </div>
        </div>

        <!-- ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Charts Grid) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <div class="panel p-5 border-t-2 border-t-teal-500">
                <h2 class="text-sm font-semibold text-slate-300 mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-teal-500"></span> 1. ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏ï‡∏µ‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©
                </h2>
                <div class="chart-container"><canvas id="chartSteam"></canvas></div>
            </div>

            <div class="panel p-5 border-t-2 border-t-rose-500">
                <h2 class="text-sm font-semibold text-slate-300 mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-rose-500"></span> 2. ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Baht)
                </h2>
                <div class="chart-container"><canvas id="chartCost"></canvas></div>
            </div>

            <div class="panel p-5 border-t-2 border-t-purple-500">
                <h2 class="text-sm font-semibold text-slate-300 mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-purple-500"></span> 3. ‡∏ñ‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏≠‡∏ô‡πâ‡∏≥ (‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô & ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô) Target 208
                </h2>
                <div class="chart-container"><canvas id="chartCoalWater"></canvas></div>
            </div>

            <div class="panel p-5 border-t-2 border-t-amber-500">
                <h2 class="text-sm font-semibold text-slate-300 mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-amber-500"></span> 4. ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ö‡∏≤‡∏ó/Output (‡πÅ‡∏¢‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)
                </h2>
                <div class="chart-container"><canvas id="chartBahtOutput"></canvas></div>
            </div>

            <div class="panel p-5 border-t-2 border-t-indigo-500">
                <h2 class="text-sm font-semibold text-slate-300 mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-indigo-500"></span> 5. ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô (‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô)
                </h2>
                <div class="chart-container"><canvas id="chartCoalPrice"></canvas></div>
            </div>

            <div class="panel p-5 border-t-2 border-t-emerald-500">
                <h2 class="text-sm font-semibold text-slate-300 mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-emerald-500"></span> 6. ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì Output (‡∏ï‡∏±‡∏ô/‡∏ß‡∏±‡∏ô)
                </h2>
                <div class="chart-container"><canvas id="chartOutput"></canvas></div>
            </div>

        </div>
    </div>

    <script>
        // =========================================================================
        // ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤: ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (Column Mapping)
        // =========================================================================
        const COLUMN_MAP = {
            date: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", 
            steam_total: "‡πÑ‡∏≠‡∏ô‡πâ‡∏≥‡∏ï‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏ß‡∏°", 
            steam_isowa: "‡πÑ‡∏≠‡∏ô‡πâ‡∏≥‡∏ï‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï ISOWA (ML)",
            steam_bhs: "‡πÑ‡∏≠‡∏ô‡πâ‡∏≥‡∏ï‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï BHS (ML)",
            steam_yueli: "‡πÑ‡∏≠‡∏ô‡πâ‡∏≥‡∏ï‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï YUELI(ML)", 
            coal_cost_total: "Baht Total",
            cw_total: "‡∏ñ‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏≠‡∏ô‡πâ‡∏≥BHS", 
            cw_isowa: "‡∏ñ‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏≠‡∏ô‡πâ‡∏≥ ISOWA",
            cw_bhs: "‡∏ñ‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏≠‡∏ô‡πâ‡∏≥BHS",
            cw_yueli: "‡∏ñ‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏≠‡∏ô‡πâ‡∏≥YUELI",
            bo_total: "Baht/Output Total",
            bo_isowa: "‡∏ö‡∏≤‡∏ó‡∏ï‡πà‡∏≠ Output ISOWA",
            bo_bhs: "‡∏ö‡∏≤‡∏ó‡∏ï‡πà‡∏≠OUTPUT BHS",
            bo_yueli: "‡∏ö‡∏≤‡∏ó‡∏ï‡πà‡∏≠OUTPUT YUELI",
            coal_price: "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô", 
            output_total: "Output Total",  
            output_isowa: "Output ISOWA",  
            output_bhs: "Output BHS",      
            output_yueli: "Output YUELI"   
        };

        const SHEET_ID = '1qS-AaBlEmWWlRaCV7_ESLCzBbB0JGVfKCBXrB8PpdCs';
        const GID = '48785430'; 
        const csvUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

        let rawData = [];
        let currentData = [];
        const chartInstances = {};

        // üé® ‡∏ä‡∏∏‡∏î‡∏™‡∏µ Neon ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dark Theme
        const THEME = {
            isowa:  { border: '#0ea5e9', bg: 'rgba(14, 165, 233, 0.2)', solid: '#0ea5e9' }, // Cyan/Sky Blue
            bhs:    { border: '#a855f7', bg: 'rgba(168, 85, 247, 0.2)', solid: '#a855f7' }, // Purple
            yueli:  { border: '#facc15', bg: 'rgba(250, 204, 21, 0.2)', solid: '#facc15' }, // Yellow
            total:  { border: '#2dd4bf', bg: 'rgba(45, 212, 191, 0.1)', solid: '#2dd4bf' }, // Teal
            target: { border: '#f43f5e', bg: 'transparent', solid: '#f43f5e' },             // Rose (Red)
            cost:   { border: '#f43f5e', bg: 'rgba(244, 63, 94, 0.2)',  solid: '#f43f5e' }, // Rose
            price:  { border: '#6366f1', bg: 'rgba(99, 102, 241, 0.2)', solid: '#6366f1' }  // Indigo
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ (‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤ Error ‡∏≠‡∏¢‡πà‡∏≤‡∏á #DIV/0!)
        const parseNum = (val) => {
            if (val === undefined || val === null || val === '') return null;
            if (typeof val === 'number') return val;
            
            const strVal = val.toString().trim().toUpperCase();
            if (strVal.includes('#DIV/0!') || strVal.includes('#REF!') || strVal.includes('#VALUE!') || strVal.includes('#N/A')) {
                return null;
            }

            const parsed = parseFloat(strVal.replace(/,/g, '').replace(/[^0-9.-]+/g,""));
            return isNaN(parsed) ? null : parsed;
        };

        const extractCol = (row, exactName) => {
            if (row[exactName] !== undefined) return parseNum(row[exactName]);
            const normalizedTarget = exactName.replace(/\s+/g, '').toLowerCase();
            const matchedKey = Object.keys(row).find(k => k.replace(/\s+/g, '').toLowerCase() === normalizedTarget);
            return matchedKey ? parseNum(row[matchedKey]) : null;
        };

        const parseDate = (dateStr) => {
            if (!dateStr) return new Date();
            const parts = dateStr.split(/[-/]/);
            if (parts.length === 3) {
                let day = parseInt(parts[0], 10);
                let month = parseInt(parts[1], 10) - 1;
                let year = parseInt(parts[2], 10);
                if (year > 2500) year -= 543;
                if (parts[0].length === 4) { year = parseInt(parts[0], 10); month = parseInt(parts[1], 10) - 1; day = parseInt(parts[2], 10); }
                return new Date(year, month, day);
            }
            return new Date(dateStr);
        };

        const formatDateToYYYYMMDD = (d) => {
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        };

        const monthNamesThai = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏ß‡∏ô (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞ ‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ)
        function populateQuickMonth() {
            const select = document.getElementById('quick-month');
            select.innerHTML = '<option value="">-- ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏≠‡∏á --</option>';
            
            const years = new Set();
            const yearMonths = new Set();
            
            rawData.forEach(d => {
                const y = d.dateObj.getFullYear();
                const m = String(d.dateObj.getMonth() + 1).padStart(2, '0');
                years.add(y);
                yearMonths.add(`${y}-${m}`);
            });

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏õ‡∏µ‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
            Array.from(years).sort((a,b) => b-a).forEach(y => {
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ"
                const yearOption = new Option(`‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ ${y}`, `Y:${y}`);
                yearOption.classList.add('font-bold', 'text-teal-400');
                select.add(yearOption);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡∏µ‡∏ô‡∏±‡πâ‡∏ô‡πÜ
                Array.from(yearMonths)
                    .filter(ym => ym.startsWith(y))
                    .sort()
                    .forEach(ym => {
                        const [year, month] = ym.split('-');
                        const monthName = monthNamesThai[parseInt(month) - 1];
                        select.add(new Option(`  ‚îî ${monthName} ${year}`, `M:${ym}`));
                    });
            });
        }

        function applyQuickMonth() {
            const val = document.getElementById('quick-month').value;
            if (!val) return;

            const [type, data] = val.split(':');
            let startDate, endDate;

            if (type === 'Y') {
                // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ
                startDate = new Date(data, 0, 1);
                endDate = new Date(data, 11, 31);
            } else {
                // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                const [year, month] = data.split('-');
                startDate = new Date(year, month - 1, 1);
                endDate = new Date(year, month, 0);
            }

            document.getElementById('start-date').value = formatDateToYYYYMMDD(startDate);
            document.getElementById('end-date').value = formatDateToYYYYMMDD(endDate);
            
            applyFilters();
        }

        function clearQuickMonth() {
            document.getElementById('quick-month').value = '';
        }

        function loadData() {
            document.getElementById('loading-overlay').style.display = 'flex';
            const noCacheUrl = csvUrl + "&t=" + new Date().getTime();

            Papa.parse(noCacheUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (results.data.length === 0) {
                        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏ü‡∏•‡πå Google Sheet");
                        document.getElementById('loading-overlay').style.display = 'none';
                        return;
                    }

                    rawData = results.data.map(row => {
                        const dObj = parseDate(row[COLUMN_MAP.date]);
                        
                        let steam_i = extractCol(row, COLUMN_MAP.steam_isowa);
                        let steam_b = extractCol(row, COLUMN_MAP.steam_bhs);
                        let steam_y = extractCol(row, COLUMN_MAP.steam_yueli);
                        let steam_t = extractCol(row, COLUMN_MAP.steam_total);
                        if(steam_t === null) {
                            let valid = [steam_i, steam_b, steam_y].filter(v => v !== null && v > 0);
                            steam_t = valid.length ? valid.reduce((a,b)=>a+b,0)/valid.length : null;
                        }

                        let cw_i = extractCol(row, COLUMN_MAP.cw_isowa);
                        let cw_b = extractCol(row, COLUMN_MAP.cw_bhs);
                        let cw_y = extractCol(row, COLUMN_MAP.cw_yueli);
                        let cw_t = extractCol(row, COLUMN_MAP.cw_total);

                        return {
                            dateObj: dObj,
                            dateStr: `${String(dObj.getDate()).padStart(2, '0')}/${String(dObj.getMonth() + 1).padStart(2, '0')}/${dObj.getFullYear()}`,
                            year: dObj.getFullYear(),
                            month: dObj.getMonth() + 1,
                            timeValue: dObj.getTime(),
                            steam_total: steam_t, steam_isowa: steam_i, steam_bhs: steam_b, steam_yueli: steam_y,
                            coal_cost_total: extractCol(row, COLUMN_MAP.coal_cost_total),
                            cw_total: cw_t, cw_isowa: cw_i, cw_bhs: cw_b, cw_yueli: cw_y,
                            bo_total: extractCol(row, COLUMN_MAP.bo_total), bo_isowa: extractCol(row, COLUMN_MAP.bo_isowa), bo_bhs: extractCol(row, COLUMN_MAP.bo_bhs), bo_yueli: extractCol(row, COLUMN_MAP.bo_yueli),
                            coal_price: extractCol(row, COLUMN_MAP.coal_price),
                            output_total: extractCol(row, COLUMN_MAP.output_total), output_isowa: extractCol(row, COLUMN_MAP.output_isowa), output_bhs: extractCol(row, COLUMN_MAP.output_bhs), output_yueli: extractCol(row, COLUMN_MAP.output_yueli)
                        };
                    }).sort((a, b) => a.timeValue - b.timeValue);

                    currentData = [...rawData];
                    populateQuickMonth();
                    
                    if(rawData.length > 0) {
                        const minDate = formatDateToYYYYMMDD(rawData[0].dateObj);
                        const maxDate = formatDateToYYYYMMDD(rawData[rawData.length - 1].dateObj);
                        const startInput = document.getElementById('start-date');
                        const endInput = document.getElementById('end-date');
                        if (!startInput.value) startInput.value = minDate;
                        if (!endInput.value) endInput.value = maxDate;
                    }

                    document.getElementById('loading-overlay').style.display = 'none';
                    document.getElementById('main-content').classList.remove('hidden');
                    updateDashboard();
                }
            });
        }

        function applyFilters() {
            const startStr = document.getElementById('start-date').value;
            const endStr = document.getElementById('end-date').value;
            if (!startStr || !endStr) return;

            const startTime = new Date(startStr).setHours(0,0,0,0);
            const endTime = new Date(endStr).setHours(23, 59, 59, 999); 

            currentData = rawData.filter(item => {
                return item.timeValue >= startTime && item.timeValue <= endTime;
            });
            updateDashboard();
        }

        function resetFilters() {
            clearQuickMonth();
            if(rawData.length > 0) {
                document.getElementById('start-date').value = formatDateToYYYYMMDD(rawData[0].dateObj);
                document.getElementById('end-date').value = formatDateToYYYYMMDD(rawData[rawData.length - 1].dateObj);
            }
            applyFilters();
        }

        Chart.defaults.font.family = "'Prompt', sans-serif";
        Chart.defaults.color = '#94a3b8';
        
        function createOrUpdateChart(chartId, type, labels, datasets, options = {}) {
            const ctx = document.getElementById(chartId).getContext('2d');
            const defaultOptions = {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: { 
                    legend: { position: 'top', labels: { usePointStyle: true, boxWidth: 6, padding: 15, color: '#cbd5e1' } },
                    tooltip: { backgroundColor: 'rgba(15, 23, 42, 0.95)', titleColor: '#f8fafc', bodyColor: '#cbd5e1', borderColor: '#334155', borderWidth: 1, padding: 12, cornerRadius: 8 }
                },
                scales: {
                    x: { grid: { color: 'rgba(255, 255, 255, 0.05)', drawBorder: false }, ticks: { color: '#64748b' } },
                    y: { grid: { color: 'rgba(255, 255, 255, 0.05)', drawBorder: false }, ticks: { color: '#64748b' } }
                }
            };

            const finalOptions = { ...defaultOptions, ...options };
            if(chartInstances[chartId]) {
                chartInstances[chartId].data.labels = labels;
                chartInstances[chartId].data.datasets = datasets;
                chartInstances[chartId].options = finalOptions;
                chartInstances[chartId].update();
            } else {
                chartInstances[chartId] = new Chart(ctx, { type, data: { labels, datasets }, options: finalOptions });
            }
        }

        function updateDashboard() {
            if(currentData.length === 0) return;

            const labels = currentData.map(d => {
                const parts = d.dateStr.split('/');
                return `${parts[0]}/${parts[1]}`;
            });

            const sumValid = (arr) => arr.filter(v => v !== null).reduce((a, b) => a + b, 0);
            const totalOut = sumValid(currentData.map(d => d.output_total));
            const totalCost = sumValid(currentData.map(d => d.coal_cost_total));
            const bahtPerOutput = totalOut > 0 ? (totalCost / totalOut) : 0; 
            const validPrices = currentData.map(d => d.coal_price).filter(v => v !== null && v > 0);
            const avgCoalPrice = validPrices.length > 0 ? validPrices.reduce((a, b) => a + b, 0) / validPrices.length : 0;
            const validCw = currentData.map(d => d.cw_total).filter(v => v !== null && v > 0);
            const avgCw = validCw.length > 0 ? validCw.reduce((a, b) => a + b, 0) / validCw.length : 0;

            document.getElementById('kpi-output').innerText = totalOut.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('kpi-cost').innerText = totalCost.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('kpi-baht-output').innerText = bahtPerOutput.toLocaleString(undefined, {minimumFractionDigits: 3, maximumFractionDigits: 3});
            document.getElementById('kpi-avg-coal-price').innerText = avgCoalPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('kpi-avg-coal-water').innerText = avgCw.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});

            const getAvg = (arr) => {
                const valid = arr.filter(v => v !== null && v > 0);
                return valid.length ? valid.reduce((a, b) => a + b, 0) / valid.length : 0;
            };

            const updateSteamKPI = (id, value) => {
                const card = document.getElementById(`${id}-card`);
                const valEl = document.getElementById(id);
                const diffEl = document.getElementById(`${id}-diff`);
                if (value === 0 || isNaN(value)) {
                    valEl.innerText = "-"; diffEl.innerText = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                    card.className = "p-4 rounded-lg bg-slate-800 border border-slate-700 opacity-60";
                    return;
                }
                valEl.innerText = value.toFixed(2);
                const diff = value - 302;
                if (value <= 302) {
                    card.className = "p-4 rounded-lg bg-emerald-900/20 border border-emerald-500/50";
                    diffEl.innerText = `‚ñº ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤ ${Math.abs(diff).toFixed(2)}`;
                    diffEl.className = "text-xs mt-1 text-emerald-400";
                } else {
                    card.className = "p-4 rounded-lg bg-rose-900/20 border border-rose-500/50";
                    diffEl.innerText = `‚ñ≤ ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ ${Math.abs(diff).toFixed(2)}`;
                    diffEl.className = "text-xs mt-1 text-rose-400";
                }
            };

            updateSteamKPI('kpi-steam-total', getAvg(currentData.map(d => d.steam_total)));
            updateSteamKPI('kpi-steam-isowa', getAvg(currentData.map(d => d.steam_isowa)));
            updateSteamKPI('kpi-steam-bhs', getAvg(currentData.map(d => d.steam_bhs)));
            updateSteamKPI('kpi-steam-yueli', getAvg(currentData.map(d => d.steam_yueli)));

            const monthlyCwAvg = {};
            currentData.forEach(d => {
                const ym = `${d.year}-${d.month}`;
                if (!monthlyCwAvg[ym]) monthlyCwAvg[ym] = { sum: 0, count: 0 };
                if (d.cw_total !== null && d.cw_total > 0) {
                    monthlyCwAvg[ym].sum += d.cw_total; monthlyCwAvg[ym].count += 1;
                }
            });
            Object.keys(monthlyCwAvg).forEach(ym => monthlyCwAvg[ym].avg = monthlyCwAvg[ym].count > 0 ? (monthlyCwAvg[ym].sum / monthlyCwAvg[ym].count) : null);
            const cwMonthlyAvgData = currentData.map(d => { const ym = `${d.year}-${d.month}`; return monthlyCwAvg[ym] ? monthlyCwAvg[ym].avg : null; });

            createOrUpdateChart('chartSteam', 'line', labels, [
                { label: '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°', data: currentData.map(d => d.steam_total), borderColor: THEME.total.border, backgroundColor: THEME.total.bg, borderWidth: 3, tension: 0.3, fill: true, spanGaps: true, pointRadius: 0 },
                { label: 'ISOWA', data: currentData.map(d => d.steam_isowa), borderColor: THEME.isowa.border, borderWidth: 2, tension: 0.3, spanGaps: true, pointRadius: 2 },
                { label: 'BHS', data: currentData.map(d => d.steam_bhs), borderColor: THEME.bhs.border, borderWidth: 2, tension: 0.3, spanGaps: true, pointRadius: 2 },
                { label: 'YUELI', data: currentData.map(d => d.steam_yueli), borderColor: THEME.yueli.border, borderWidth: 2, tension: 0.3, spanGaps: true, pointRadius: 2 },
                { label: 'Target (302)', data: currentData.map(() => 302), borderColor: THEME.target.border, borderWidth: 2, pointRadius: 0, borderDash: [5, 5], fill: false }
            ]);

            createOrUpdateChart('chartCost', 'bar', labels, [
                { label: '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô', data: currentData.map(d => d.coal_cost_total), backgroundColor: THEME.cost.solid, borderRadius: 4 }
            ]);

            createOrUpdateChart('chartCoalWater', 'bar', labels, [
                { label: '‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (Daily)', data: currentData.map(d => d.cw_total), backgroundColor: THEME.bhs.solid, borderRadius: 4, order: 3 },
                { label: '‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', data: cwMonthlyAvgData, borderColor: THEME.yueli.solid, borderWidth: 3, type: 'line', tension: 0, pointRadius: 0, borderDash: [5, 5], fill: false, order: 2 },
                { label: 'Target (208)', data: currentData.map(() => 208), borderColor: THEME.target.border, borderWidth: 2, type: 'line', pointRadius: 0, borderDash: [5, 5], fill: false, order: 1 }
            ]);

            createOrUpdateChart('chartBahtOutput', 'bar', labels, [
                { label: 'ISOWA', data: currentData.map(d => d.bo_isowa), backgroundColor: THEME.isowa.solid },
                { label: 'BHS', data: currentData.map(d => d.bo_bhs), backgroundColor: THEME.bhs.solid },
                { label: 'YUELI', data: currentData.map(d => d.bo_yueli), backgroundColor: THEME.yueli.solid },
                { label: '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°', data: currentData.map(d => d.bo_total), type: 'line', borderColor: THEME.total.border, borderWidth: 2, tension: 0.3, spanGaps: true, pointRadius: 0 }
            ]);

            createOrUpdateChart('chartCoalPrice', 'line', labels, [
                { label: '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)', data: currentData.map(d => d.coal_price), borderColor: THEME.price.border, backgroundColor: THEME.price.bg, borderWidth: 3, fill: true, tension: 0.3, spanGaps: true, pointRadius: 0 }
            ]);

            createOrUpdateChart('chartOutput', 'bar', labels, [
                { label: 'ISOWA', data: currentData.map(d => d.output_isowa), backgroundColor: THEME.isowa.solid },
                { label: 'BHS', data: currentData.map(d => d.output_bhs), backgroundColor: THEME.bhs.solid },
                { label: 'YUELI', data: currentData.map(d => d.output_yueli), backgroundColor: THEME.yueli.solid }
            ], { scales: { x: { stacked: true }, y: { stacked: true } } });
        }

        window.onload = loadData;
    </script>
</body>
</html>